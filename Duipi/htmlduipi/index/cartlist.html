<include file="./index/index.header"/>
<meta name="keywords" content=<if condition="isset($guanjianzi)">"{$guanjianzi}"<else/>"{:C('web_key')}"</if> />
<meta name="description" content=<if condition="isset($miaoshu)">"{$miaoshu}"<else/>"{:C('web_des')}"</if> />
 
      <link rel="stylesheet" type="text/css" href="__PUBLIC__/piyungou/css/Comm.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/piyungou/css/CartList.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/piyungou/css/style.css"/>

<script type="text/javascript" src="__PUBLIC__/plugin/style/global/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/piyungou/js/jquery.cookie.js"></script>
</head>
<body>
    <div class="logo">
        <div class="float">
            <span class="logo_pic">
                <h2>{$Think.lang.web_index_confirm_order}</h2>
                </a></span>
            <ul class="ui-step" style='float:right;margin-top:10px'>
                <li class="ui-step-start ui-step-active">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="ui-step-number">{$Think.lang.web_index_submit}</i>
                        <span class="ui-step-text">&nbsp;</span>
                    </div>
                </li>
                <li class="ui-step-center">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="ui-step-number">{$Think.lang.web_index_pay}</i>
                        <span class="ui-step-text">&nbsp;</span>
                    </div>
                </li>
                <li class="ui-step-center">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="ui-step-number">{$Think.lang.web_index_draw}</i>
                        <span class="ui-step-text">&nbsp;</span>
                    </div>
                </li>
                <li class="ui-step-end">
                    <div class="ui-step-line">-</div>
                    <div class="ui-step-icon">
                        <i class="ui-step-number">{$Think.lang.web_index_announce}</i>
                        <span class="ui-step-text">&nbsp;</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="shop_process">
        <div class="i_tips"></div>
        <div class="submitted">
            <ul class="order">
                <li class="top">
                    <span class="goods">{$Think.lang.web_lottery_goods}</span>
                    <span class="name">{$Think.lang.web_cart_name}</span>
                    <span class="moneys">{$Think.lang.web_glist_value}</span>
                    <span class="money">{$Think.lang.web_cart_money}</span>
                    <span class="num">{$Think.lang.web_cart_num}</span>
                    <span class="xj">{$Think.lang.web_cart_xiaoji}</span>
                    <span class="do">{$Think.lang.web_cart_chaozuo}</span>
                </li>
                  <script>
                        var chooselist = localStorage.getItem('chooselist');
                        if(!chooselist){
                                            var datas = {};
                                    }else{
                                            var datas = $.evalJSON(chooselist);
                                            if((typeof datas) !== 'object'){
                                                    var datas = {};
                                            }
                                    }
                        </script>
                <foreach name="yyslist" item="shops" >
                <li class="end" id="shoplist{$shops['id']}">
                    <span class="goods">
                        <a href="__ROOT__/goods/items/goodsId/{$shops['id']}.html">
                            <img src="__PUBLIC__/uploads/{$shops['thumb']}" />
                        </a>                    
                    </span>
                    <span class="name">
                        <a href="__ROOT__/goods/items/goodsId/{$shops['id']}.html" >{$shops['title']}</a>
                        <if condition="$shops['pay_ygb'] eq 1">
                        <p style="color:red">{$Think.lang.web_cart_point}</p>
                        </if>
                        <p>{$Think.lang.web_lottery_all_has} <span class="color">{$shops['zongrenshu']}</span>{$Think.lang.web_cart_person}
                            <span class="gorenci">{$shops['cart_shenyu']}</span> {$Think.lang.web_lottery_person}
                        </p>
                    </span>
                    <span class="moneys">{$Think.lang.web_lottery_mark}{$shops['money']}</span>
                    <span class="money"><span class="color">{$Think.lang.web_lottery_mark}<b>{$shops['yunjiage']}</b></span></span>
                    <if condition="$shops['cart_shenyu']=='0'">	
                    <span class="num">				
                        <dl class="add">					
                            <dd><input type="type" val="{$shops['id']}" onkeyup="value = value.replace(/\D/g, '')" value="{$shops['cart_gorenci']}" class="amount" disabled style="width:55px"/></dd>                    
                        </dl>
                        <p class="message" style="margin-left:12px;color:black">{$Think.lang.web_cart_goods}</p>
                    </span> 
                    <span  class="xj">0.00</span> 
                    <elseif condition="$shops['is_choose'] eq 1"/>
                     <span class="num">				
							<dl class="add">					
							<dd><input type="type" val="{$shops['id']}" onkeyup="value=value.replace(/\D/g,'')" value="{$shops['cart_gorenci']}" class="amount" disabled /></dd>                    
							<dd>
									<a href="JavaScript:;" val="{$shops['id']}" class="jia" style="display:none"></a>
									<a href="JavaScript:;" val="{$shops['id']}" class="jian" style="display:none"></a>
								</dd>      
                                                        </dl>
		                    <p class="message" style="margin-left:12px;color:black" >{$Think.lang.web_cart_phone}</p>
						</span> 
						<span  class="xj">{$shops['cart_xiaoji']}</span>  

                                            <script>
                                              var shopsid="{$shops['id']}";
                                              if(!datas[shopsid]){
                                                $(".add input[val="+shopsid+"]").removeAttr("disabled");
                                                $(".add input[val="+shopsid+"]").parent().parent().next().text("");
                                                $(".add a[val="+shopsid+"]").attr("style","");
                                              }
                                            </script>
                    <else/>
                    <span class="num">				
                        <dl class="add">					
                            <dd><input type="type" val="{$shops['id']}" onkeyup="value = value.replace(/\D/g, '')" value="{$shops['cart_gorenci']}" class="amount" /></dd>
                            <dd>
                                <a href="JavaScript:;" val="{$shops['id']}" class="jia"></a>
                                <a href="JavaScript:;" val="{$shops['id']}" class="jian"></a>
                            </dd>                        
                        </dl>
                        <p class="message"></p>
                    </span> 
                    <span  class="xj">{$shops['cart_xiaoji']}</span>  
                    </if>
                    <span class="do"><a href="javascript:;" onclick="delcart({$shops['id']})"  class="delgood">{$Think.lang.web_cart_delete}</a></span>
                </li>     		
                </foreach>
                <li class="ts">
                    <p class="right">{$Think.lang.web_cart_yungou}:{$Think.lang.web_lottery_mark}<span id="moenyCount">{$MoenyCount}</span></p>
                </li>
            </ul>
        </div>
        <h5>
            <a href="__ROOT__/index/index" id="but_on"></a>
            <input id="but_ok" type="button" value=""  name="submit"/>
        </h5>
    </div> 

    <script type="text/javascript">
        var info = "{$gouwucheshopinfo}";
        info = eval('(' + info + ')');  
        var numberadd = $(".jia");
        var numbersub = $(".jian");
        var xiaoji = $(".xj");
        var num = $(".amount");
        var message = $(".message");
        var moenyCount = $("#moenyCount");

        $(function () {
            $("#but_ok").click(function () {
                var countmoney = parseInt(moenyCount.text());
                if (countmoney > 0) {
                    $.cookie('Cartlist','',{path:'/'});
                    $.cookie('Cartlist', $.toJSON(info), {expires: 7, path: '/'});
                    document.location.href = '__ROOT__/pay/pay/' + new Date().getTime();
                } else {
                    alert("购物车为空!");
                }
            });
        });
        function UpdataMoney(shopid, number, zindex) {
            var number = parseInt(number);
            info['MoenyCount'] = info['MoenyCount'] - info[shopid]['money'] * info[shopid]['num'] + info[shopid]['money'] * number;
            info[shopid]['num'] = number;
            var xjmoney = xiaoji.eq(zindex + 1);
            xjmoney.text(info[shopid]['money'] * number + '.00');
            moenyCount.text(info['MoenyCount'] + '.00');
        }


        function delcart(id) {
            info['MoenyCount'] = info['MoenyCount'] - info[id]['money'] * info[id]['num'];
            $("#shoplist" + id).hide();
            $("#moenyCount").text(info['MoenyCount'] + ".00");
            delete info[id];
            //$.cookie('Cartlist','',{path:'/'});
            $.cookie('Cartlist', $.toJSON(info), {expires: 30, path: '/'});
            var choose=localStorage.getItem('chooselist');
            if(choose)
            {
                data = $.evalJSON(choose);
                var data1 = {};

                $.each(data, function(i, n){
                    if(i!=id)
                    {
                        data1[i]={};
                        data1[i]['code']=n.code; 
                    }
                });

                localStorage.setItem('chooselist',$.toJSON(data1));
                if($.toJSON(data1)=="{}")
                {
                    localStorage.removeItem('chooselist');
                }
            }
        }

        num.keyup(function () {
            var shopid = $(this).attr("val");
            var zindex = num.index(this);

            if ($(this).val() > info[shopid]['shenyu']) {
                message.eq(zindex).text("云购次数不能超过" + info[shopid]['shenyu'] + "次");
                $(this).val(info[shopid]['shenyu']);
                UpdataMoney(shopid, $(this).val(), zindex);
                return;
            }
            if ($(this).val() < 1) {
                message.eq(zindex).text("云购次数不能少于1次");
                $(this).val(1);
                UpdataMoney(shopid, $(this).val(), zindex);
                return;
            }
            UpdataMoney(shopid, $(this).val(), zindex);
        });
        numberadd.click(function () {
            var shopid = $(this).attr('val');
            var zindex = numberadd.index(this);
            var thisnum = num.eq(zindex);
            if (info[shopid]['num'] >= info[shopid]['shenyu']) {
                message.eq(zindex).text("云购次数不能超过" + info[shopid]['shenyu'] + "次");
                return;
            }
            var number = info[shopid]['num'] + 1;
            thisnum.val(number);
            UpdataMoney(shopid, number, zindex);
        });
        numbersub.click(function () {
            var shopid = $(this).attr('val');
            var zindex = numbersub.index(this);
            var thisnum = num.eq(zindex);
            if (info[shopid]['num'] <= 1) {
                message.eq(zindex).text("云购次数不能少于1次");
                return;
            }
            var number = info[shopid]['num'] - 1;
            thisnum.val(number);
            UpdataMoney(shopid, number, zindex);
        });

    </script> 



   <include file="./index/index.footer"/>